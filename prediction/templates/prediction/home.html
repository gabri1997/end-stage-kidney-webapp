{% extends 'prediction/base.html' %}

{% block title %}Dashboard - ESKD Predictor{% endblock %}

{% block extra_head %}
<style>
    .hero.is-primary {
        padding: 3rem 1.5rem;
    }
    .hero-icon {
        font-size: 6rem;
        margin-left: 2rem;
        opacity: 0.8;
    }
    .hero-content {
        padding: 1rem 0;
    }
    .box:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block content %}
<section class="hero is-primary is-bold">
    <div class="hero-body">
        <div class="container">
            <div class="columns is-vcentered">
                <div class="column hero-content">
                    <h1 class="title is-2">
                        Dashboard
                    </h1>
                    <h2 class="subtitle">
                        Benvenuto nel tuo sistema di predizione ESKD
                    </h2>
                </div>
                <div class="column is-narrow">
                    <span class="icon hero-icon">
                        <i class="fas fa-heartbeat"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <!-- Statistiche principali -->
        <div class="columns is-multiline">
            <div class="column is-half">
                <div class="box has-background-primary-light" style="border-radius: 12px; transition: all 0.3s ease;">
                    <article class="media">
                        <div class="media-left">
                            <span class="icon is-large has-text-primary">
                                <i class="fas fa-users fa-3x"></i>
                            </span>
                        </div>
                        <div class="media-content">
                            <div class="content">
                                <h3 class="title is-4">Pazienti Totali</h3>
                                <p class="subtitle is-2">{{ num_pazienti }}</p>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
            
            <div class="column is-half">
                <div class="box has-background-info-light" style="border-radius: 12px; transition: all 0.3s ease;">
                    <article class="media">
                        <div class="media-left">
                            <span class="icon is-large has-text-info">
                                <i class="fas fa-stethoscope fa-3x"></i>
                            </span>
                        </div>
                        <div class="media-content">
                            <div class="content">
                                <h3 class="title is-4">Visite Effettuate</h3>
                                <p class="subtitle is-2">{{ num_visite }}</p>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>

        <!-- Azioni Rapide -->
        <div class="columns">
            <div class="column is-full">
                <div class="box">
                    <h3 class="title is-4">Azioni Rapide</h3>
                    <div class="buttons are-medium">
                        <a href="{% url 'nuovo_paziente' %}" class="button is-primary">
                            <span class="icon">
                                <i class="fas fa-user-plus"></i>
                            </span>
                            <span>Nuovo Paziente</span>
                        </a>
                        <a href="{% url 'lista_pazienti' %}" class="button is-link">
                            <span class="icon">
                                <i class="fas fa-list"></i>
                            </span>
                            <span>Lista Pazienti</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ultime Predizioni -->
        <div class="columns">
            <div class="column is-full">
                <div class="box">
                    <h3 class="title is-4">
                        <span class="icon-text">
                            <span class="icon has-text-info">
                                <i class="fas fa-chart-line"></i>
                            </span>
                            <span>Ultime Predizioni</span>
                        </span>
                    </h3>
                    
                    {% if ultime_predizioni %}
                    <table class="table is-fullwidth">
                        <thead>
                            <tr>
                                <th>Paziente</th>
                                <th>Data</th>
                                <th>Esito</th>
                                <th>Probabilità</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pred in ultime_predizioni %}
                            <tr>
                                <td>
                                    <a href="{% url 'dettaglio_paziente' pred.paziente.id %}">
                                        {{ pred.paziente.cognome }} {{ pred.paziente.nome }}
                                    </a>
                                </td>
                                <td>{{ pred.data_predizione|date:"d/m/Y" }}</td>
                                <td>
                                    {% if pred.esito == 'ALTO' %}
                                        <span class="tag is-danger">Alto</span>
                                    {% elif pred.esito == 'MEDIO' %}
                                        <span class="tag is-warning">Medio</span>
                                    {% else %}
                                        <span class="tag is-success">Basso</span>
                                    {% endif %}
                                </td>
                                <td>{{ pred.probabilita_eskd|floatformat:1 }}%</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="has-text-grey">Nessuna predizione effettuata</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-primary">
                        <i class="fas fa-chart-line fa-3x"></i>
                    </span>
                    <h3 class="title is-4 mt-4">Monitoraggio Continuo</h3>
                    <p class="subtitle is-6">
                        Tieni traccia dell'evoluzione del rischio nel tempo per ogni paziente
                    </p>
                </div>
            </div>
            <div class="column is-one-third">
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-primary">
                        <i class="fas fa-clipboard-check fa-3x"></i>
                    </span>
                    <h3 class="title is-4 mt-4">Gestione Completa</h3>
                    <p class="subtitle is-6">
                        Gestisci visite, referti MEST-C e predizioni in un'unica piattaforma
                    </p>
                </div>
            </div>
        </div>

        <div class="box mt-6">
            <div class="content">
                <h3 class="title is-4">Come Funziona</h3>
                <div class="steps">
                    <div class="step-item">
                        <div class="step-marker">1</div>
                        <div class="step-details">
                            <p class="step-title">Inserisci i Dati del Paziente</p>
                            <p>Registra le informazioni anagrafiche e cliniche del paziente</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">2</div>
                        <div class="step-details">
                            <p class="step-title">Aggiungi i Referti MEST-C</p>
                            <p>Inserisci i risultati dell'analisi istologica</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">3</div>
                        <div class="step-details">
                            <p class="step-title">Ottieni la Predizione</p>
                            <p>Il sistema calcolerà automaticamente il rischio di ESKD</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .steps {
        display: flex;
        justify-content: space-between;
        margin: 2rem 0;
    }
    .step-item {
        flex: 1;
        text-align: center;
        padding: 1rem;
    }
    .step-marker {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background-color: #00d1b2;
        color: white;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
    }
    .step-title {
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    .hero.is-primary {
        background: linear-gradient(135deg, #00d1b2 0%, #1e88e5 100%);
    }
    .hero img {
        max-height: 400px;
        margin: 0 auto;
    }
</style>
{% endblock %}