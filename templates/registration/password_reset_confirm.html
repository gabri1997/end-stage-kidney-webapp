{% extends "prediction/base.html" %}
{% load static %}

{% block title %}Imposta nuova password - ESKD Predictor{% endblock %}

{% block content %}
<section class="section">
  <div class="container" style="max-width: 520px;">
    <div class="box">
      {% if validlink %}
        <h1 class="title is-4 has-text-centered">Imposta la nuova password</h1>
        <form method="post">
          {% csrf_token %}

          <div class="field">
            <label class="label" for="id_new_password1">Nuova password</label>
            <div class="control has-icons-left">
              <input class="input" type="password" name="new_password1" id="id_new_password1" autocomplete="new-password" required>
              <span class="icon is-small is-left"><i class="fas fa-key"></i></span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="id_new_password2">Conferma password</label>
            <div class="control has-icons-left">
              <input class="input" type="password" name="new_password2" id="id_new_password2" autocomplete="new-password" required>
              <span class="icon is-small is-left"><i class="fas fa-check-circle"></i></span>
            </div>
          </div>

          {% if form.errors %}
            <div class="notification is-danger is-light">
              <strong>Controlla il form:</strong>
              <ul class="mt-2" style="margin-left:1rem;">
                {% for field in form %}
                  {% for error in field.errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <div class="field">
            <button type="submit" class="button is-link is-fullwidth">
              <span class="icon"><i class="fas fa-save"></i></span>
              <span>Cambia password</span>
            </button>
          </div>
        </div>
      {% else %}
        <div class="notification is-danger is-light">
          <p class="mb-2"><strong>Link non valido</strong></p>
          <p>Il link per il reset della password non è valido o è già stato utilizzato.</p>
        </div>
        <a href="{% url 'password_reset' %}" class="button is-link is-light">
          <span class="icon"><i class="fas fa-envelope"></i></span>
          <span>Richiedi nuovo link via email</span>
        </a>
        <a href="{% url 'password_reset_security_start' %}" class="button is-link is-light mt-2">
          <span class="icon"><i class="fas fa-key"></i></span>
          <span>Usa recupero con domanda</span>
        </a>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
